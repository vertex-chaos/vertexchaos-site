---
import Base from "../../layouts/Base.astro";
import { site } from "../../config/site";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const studies = await getCollection("case-studies");
  return studies.map((s) => ({ params: { slug: s.slug }, props: { study: s } }));
}

const { study } = Astro.props;
const { Content } = await study.render();

const base = site.social.githubOrgBase.replace(/\/$/, "");
const repoValue = study.data.repo;
const repoUrl =
  !repoValue ? null :
  repoValue.startsWith("http://") || repoValue.startsWith("https://") ? repoValue :
  `${base}/${repoValue}`;
---
<Base title={`${study.data.title} | ${site.brand}`} description={study.data.summary}>
  <article class="card pad">
    <div class="kicker"><span class="dot"></span><span>{study.data.kind}</span><span class="badge">{(study.data.tags ?? []).slice(0,2).join(" Â· ")}</span></div>
    <h1>{study.data.title}</h1>
    <p class="lede">{study.data.summary}</p>

    <div class="grid">
      <div class="card pad item">
        <h3>When</h3>
        <p>{study.data.when ?? "Recent"}</p>
      </div>
      <div class="card pad item">
        <h3>Tags</h3>
        <p>{(study.data.tags ?? []).join(", ")}</p>
      </div>
      <div class="card pad item">
        <h3>Repo</h3>
        <p>{repoUrl ? <a href={repoUrl}>View repo</a> : "See /repos"}</p>
      </div>
    </div>

    <hr class="sep" />
    <div class="card pad">
      <Content />
    </div>

    <hr class="sep" />
    <a class="btn" href="/work">Back to work</a>
  </article>
</Base>
